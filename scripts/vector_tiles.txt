---
title: "Render Vector Tiles in Leaflet or deckgl"
editor: visual
---

Can't for the life of me figure out how to render vecor tiles from a custom server source. 
```{r}
pkgs <- c("sf", "leaflet", "maptiles", "fwapgr")

lapply(pkgs, require, character.only = TRUE)


```


```{r}
blk <- 360873822
# downstream route measure
drm <- 166030.4

aoi <- fwapgr::fwa_watershed_at_measure(blue_line_key = blk, 
                                        downstream_route_measure = drm) |> 
  sf::st_transform(4326)

aoi_osm <- get_tiles(aoi, crop = TRUE)
plot_tiles(aoi_osm)

```

Get raster (and raster only) tiles as per [maptiles](https://github.com/riatelab/maptiles)

```{r}

options(mapbox.accessToken = NA)




plot_tiles(tiles)

# dowload tiles and compose raster (SpatRaster)
t_rast <- get_tiles(x = aoi, provider = tiles, crop = TRUE, 
                       cachedir = tempdir(), verbose = TRUE)
#> Zoom: 7
#> Source(s): © OpenStreetMap contributors © CARTO 
#> Cache directory: /tmp/RtmpdG8qYB/CARTO.POSITRON
#> 8 tiles
# display map
plot_tiles(t_rast)
# display credits
mtext(text = get_credit(osmpos), side = 1, line = -1, adj = .99)
```


```{r}
#https://www.milesmcbain.com/posts/vector-tiles/
library(leaflet)
library(rdeck)


rdeck() |>
  add_mvt_layer(
    # data = "https://tiles.hillcrestgeo.ca/bcfishpass/bcfishpass.streams_bt_vw/{z}/{x}/{y}.pbf",
    data = "https://github.com/NewGraphEnvironment/fish_passage_peace_2022_webmap/raw/main/docs/style_all.json",
    opacity = 0.6
  )

leaflet(quakes) %>%
  addMapboxGL(style = "mapbox://styles/mapbox/streets-v9", accessToken =Sys.getenv('MAPBOX_ACCESS_TOKEN')) |> 
  # addMapboxGL(style = "https://raw.githubusercontent.com/NewGraphEnvironment/fish_passage_peace_2022_webmap/main/docs/style_bt", accessToken =NA) %>%
  addCircleMarkers(weight = 1, fillOpacity = 0, radius = 3)
```


```{r}
deckgl(zoom = 11, pitch = 45) %>%
  add_basemap() %>%
  add_layer(
    data = "https://tiles.hillcrestgeo.ca/bcfishpass/bcfishpass.streams_bt_vw/{z}/{x}/{y}.pbf",
    class_name = "TileLayer"
  )
```



```{r}
leaflet::leaflet() %>%
    leaflet::addTiles(urlTemplate = "https://tiles.hillcrestgeo.ca/bcfishpass/bcfishpass.streams_bt_vw/{z}/{x}/{y}.pbf") 
```

